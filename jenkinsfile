// File: Jenkinsfile (The "Back to Basics" Final Attempt)

pipeline {
    // Use the most basic agent available.
    agent any

    stages {
        stage('Build Docker Image') {
            steps {
                echo "Attempting to build Docker image using the absolute path..."
                
                // We are NOT using 'docker'. We are telling the shell to execute
                // the file located at '/usr/bin/docker'. This bypasses all PATH issues.
                sh "/usr/bin/docker build -t my-webapp:${env.BUILD_NUMBER} ."
            }
        }

        stage('Verify Build') {
            steps {
                echo "Listing Docker images on the host..."

                // We must use the absolute path here as well.
                sh "/usr/bin/docker images"
            }
        }
    }
    
    post {
        always {
            echo "Pipeline run has finished."
        }
    }
}